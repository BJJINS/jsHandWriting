<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JSONP</title>
</head>
<body>
<script>

  const jsonp = (options) => {
    if (!options) { return; }
    if (!jsonp.callBackId) {
      jsonp.callBackId = 1;
    }
    const callBackId = jsonp.callBackId;
    const {url, data} = options;
    data.callback = `jsonp[${callBackId}]`;
    const params = [];
    for (const param of Object.keys(data)) {
      params.push(`${param}=${data[param]}`);
    }
    const script = document.createElement('script');
    script.src = url + '?' + params.join('&');
    document.body.appendChild(script);
    jsonp.callBackId++;
    return new Promise((resolve, reject) => {
      try {
        jsonp[callBackId] = function(data) {
          resolve(data);
          Reflect.deleteProperty(jsonp, callBackId);
        };
      } catch (error) {
        reject(error);
      } finally {
        script.parentNode.removeChild(script);
      }
    });
  };

  jsonp({url: 'http://127.0.0.1:3001', data: {name: 'bjjin', age: '12'}, cb: 'show'}).then(value => console.log(value));
  jsonp({url: 'http://127.0.0.1:3001', data: {name: '12', age: '12'}, cb: 'show'}).then(value => console.log(value));

</script>
</body>
</html>